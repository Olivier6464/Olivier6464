function getSelectionsListe(id){const liste=document.getElementById(id);let lsSelections="";for(let i=0;i<liste.options.length;i++)liste.options[i].selected&&(lsSelections+=liste.options[i].value+", ");return lsSelections}const spacer={blank:function(){return" "},newline:function(){return"\n"},line:function(length,character){let s="";for(let i=0;i<length;i++)s+=character;return s},wrap:function(text,length,character){let padLength=(length-text.length)/2-1,wrapText=character+spacer.line(padLength," ")+text;return wrapText+=spacer.line(padLength," "),wrapText},box:function(text,character){let boxText=spacer.newline(),length=text.length+38;return"="===character&&(length=25),"*"===character&&(length=40),boxText+=spacer.line(length,character)+spacer.newline(),boxText+=spacer.wrap(text,length,character)+spacer.newline(),boxText+=spacer.line(length,character)+spacer.newline(),boxText}};function affichage(){let bil="";const esp=" ",rtl="\n",egal="=",douleurRepos=document.getElementById("douleurRepos").value,douleurMob=document.getElementById("douleurMob").value,nom=document.getElementById("nom").value,prenom=document.getElementById("prenom").value,remarques=document.getElementById("remarques").value;let nch=null,cote=null;const marche="Marche (périmètre, aides techniques ...): ",lplfonc=marche.length,assis="Équilibre assis: ",debout="Équilibre debout: ",transferts="Transferts (lit vers fauteuil): ",doubletache="Double tâche: ",oedeme="Oedème: ",hematome="Hématome: ",inflamation="Inflammation: ",amyotrophie="Amyotrophie: ",mobilisation="A la mobilisation: ",repos="Au repos:",lpldoul=mobilisation.length;bil+=document.getElementById("civilite").value+" "+nom.replace(/(^\w{1})|(\s+\w{1})/g,letter=>letter.toUpperCase())+" "+prenom.replace(/(^\w{1})|(\s+\w{1})/g,letter=>letter.toUpperCase()),nch=document.getElementById("chambre").value,cote=document.getElementById("cote").value,cote=cote.toUpperCase();const regex=/^[0-9]+$/;nch.match(regex)&&(bil+="  CH n°: "+document.getElementById("chambre").value,"P"!==cote&&"F"!==cote||(bil+=" L"+cote)),bil+="\nDate d'admission: "+frenchdate(document.getElementById("entree").value),""!==document.getElementById("anamnese").value&&(bil+=rtl+spacer.box("ANAMNÈSE","="),bil+=rtl+document.getElementById("anamnese").value),""!==document.getElementById("histoire").value&&(bil+=rtl+spacer.box("HISTOIRE DE LA MALADIE","="),bil+=rtl+document.getElementById("histoire").value),""!==document.getElementById("modeDeVie").value&&(bil+=rtl+spacer.box(" Mode de vie","="),bil+=rtl+document.getElementById("modeDeVie").value),""!==document.getElementById("atcd").value&&(bil+=rtl+spacer.box("Antécédents","="),bil+=rtl+document.getElementById("atcd").value),bil+=rtl+spacer.box(" Prescription médicale","=")+rtl+document.getElementById("pec").value,""!==document.getElementById("operation").value&&(bil+="\n\nDate de l'opération: "+frenchdate(document.getElementById("operation").value)),""!==document.getElementById("appui").value&&(bil+="\nAppui ( total/limité/sans appui ): "+document.getElementById("appui").value),""!==document.getElementById("immobilisation").value&&(bil+="\nImmobilisation (plâtre/attelle...): "+document.getElementById("immobilisation").value),bil+=rtl+spacer.box(" Cotation de la Douleur EVS","="),bil+="\nÉchelle de 0 à 4.",bil+="\n 0 = pas de douleur, 1 = faible, 2 = moyenne, 3 = forte, 4 = très forte.\n",bil+=rtl+repos+spacer.line(lpldoul-repos.length+3,".")+" "+douleurRepos+"/4",bil+=rtl+mobilisation+" "+douleurMob+"/4","0"===douleurRepos&&"0"===douleurMob||(bil+="\nType: "+getSelectionsListe("typeDouleur"),bil+="\nLocalisation: "+document.getElementById("localisation").value),bil+=rtl+spacer.box("FONCTIONNEL","="),bil+=rtl+assis+spacer.line(lplfonc-assis.length+5,".")+" "+document.getElementById("assis").value,bil+=rtl+debout+spacer.line(lplfonc-debout.length,".")+spacer.line(2,".")+" "+document.getElementById("debout").value,bil+=rtl+transferts+spacer.line(lplfonc-transferts.length,".")+" "+document.getElementById("transferts").value,bil+=rtl+doubletache+spacer.line(lplfonc-doubletache.length+1,".")+spacer.line(3,".")+" "+document.getElementById("doubleTache").value,bil+="\n\nAutonomie AVJ: "+document.getElementById("autonomie").value,bil+="\n\n"+marche+document.getElementById("marche").value,bil+=rtl+spacer.box("TROPHICITÉ","="),bil+=rtl+oedeme+spacer.line(lplfonc-oedeme.length+4,".")+" "+document.getElementById("oedeme").value,bil+=rtl+hematome+spacer.line(lplfonc-hematome.length,".")+spacer.line(2,".")+" "+document.getElementById("hematome").value,bil+=rtl+amyotrophie+spacer.line(lplfonc-amyotrophie.length+1,".")+" "+document.getElementById("amyotrophie").value,bil+=rtl+inflamation+spacer.line(lplfonc-inflamation.length+1,".")+" "+document.getElementById("inflamation").value,""!==remarques&&(bil+="\n\nA noter: \n"+remarques),""!==document.getElementById("attitudeVicieuse").value&&(bil+=rtl+spacer.box("ARTICULAIRE","="),bil+="\nAttitude vicieuse: "+document.getElementById("attitudeVicieuse").value,bil+="\nAmplitude: "+document.getElementById("amplitude").value),bil+=rtl+spacer.box("MUSCULAIRE","="),bil+="\nVerrouillage quadriceps: \n"+document.getElementById("verrouillage").value,bil+="\n\nAutres groupes musculaires: "+document.getElementById("autres").value,bil+=rtl+spacer.box(" Fonctions Supérieures","=")+rtl+document.getElementById("fonctionsSuperieures").value,""!==document.getElementById("fonctionsRespiratoires").value&&(bil+=rtl+spacer.box(" Fonctions Respiratoires","=")+rtl+document.getElementById("fonctionsRespiratoires").value),bil+=rtl+spacer.box(" Projet kiné du patient","=")+rtl+document.getElementById("projetKine").value,bil+=rtl+spacer.box(" Objectifs et prise en charge prévisionnelle","=")+rtl+document.getElementById("priseEnChargePrev").value;const toCopy=document.getElementById("to-copy");toCopy.value=bil,navigator.clipboard.writeText(bil);const modal=document.getElementById("modal");function modalEscape(){modal.onkeyup=function(e){console.log(e.key),"k"==e.key&&modal.classList.remove("show")}}modal.classList.add("show"),document.addEventListener("keyup",e=>{e.stopPropagation(),"z"==e.key&&modal.classList.remove("show")});const modalClose=document.querySelectorAll("[data-dismiss=dialog]");for(let close of modalClose){close.addEventListener("click",()=>{modal.classList.remove("show")});const btnCopy=document.getElementById("to-copy");btnCopy.addEventListener("click",()=>{navigator.clipboard.writeText(toCopy.value)})}modal.addEventListener("click",(function(){this.classList.remove("show")})),modal.children[0].addEventListener("click",(function(e){e.stopPropagation()}))}function replaceSelection(idfield,idoption){const d=document.getElementById(idoption),elem=document.getElementById(idfield);function listenKeyUpOnOptions(e){if(e.preventDefault(),"Space"===e.code||"Enter"===e.code){let word=d.options[d.selectedIndex].value;document.getElementById(idoption).size=1,word=word.replace(/\s\s+/g," ");const from=elem.selectionStart,to=elem.selectionEnd;elem.value=elem.value.slice(0,from)+word+elem.value.slice(to),elem.selectionStart=from+word.length,elem.selectionEnd=from+word.length,document.getElementById(idoption).selectedIndex=0,elem.focus(),d.removeEventListener("keyup",listenClickOnOptions)}}function listenClickOnOptions(e){e.preventDefault();let word=d.options[d.selectedIndex].value;document.getElementById(idoption).size=1,word=word.replace(/\s\s+/g," ");const from=elem.selectionStart,to=elem.selectionEnd;elem.value=elem.value.slice(0,from)+word+elem.value.slice(to),elem.selectionStart=from+word.length,elem.selectionEnd=from+word.length,document.getElementById(idoption).selectedIndex=0,elem.focus(),d.removeEventListener("click",listenClickOnOptions)}d.addEventListener("keyup",listenKeyUpOnOptions,!1),d.addEventListener("click",listenClickOnOptions,!1)}function frenchdate(strDate){const ch=strDate.split("-").reverse().join("/");return ch}const efface=document.getElementById("reinitialise");efface.addEventListener("click",e=>location.reload(!0),!1);const chselect=document.querySelectorAll("select"),seltab=Array.from(chselect);function heure(){var h=new Date;document.getElementById("temps").innerHTML=(h.getHours()<10?"0"+h.getHours():h.getHours())+":"+(h.getMinutes()<10?"0"+h.getMinutes():h.getMinutes())+":"+(h.getSeconds()<10?"0"+h.getSeconds():h.getSeconds()),setTimeout(heure,1e3)}function fdate(){const date=new Date,nday=date.getDate()+1<10?"0"+date.getDate():date.getDate(),month=date.getMonth()+1<10?"0"+(date.getMonth()+1):date.getMonth()+1,year=date.getFullYear()-2e3,laDate=nday+"/"+month+"/"+year;document.getElementById("laDate").innerHTML=laDate,date.setDate(date.getDate()-1),document.getElementById("entree").valueAsDate=date}seltab.forEach(elem=>{elem.addEventListener("focus",(function(event){event.target.size=elem.options.length}),!1)}),seltab.forEach(elem=>elem.addEventListener("blur",(function(event){event.target.size=1}),!1)),heure(),fdate(),document.addEventListener("DOMContentLoaded",(function(){const textareas=document.getElementsByTagName("textarea");for(let i=0;i<textareas.length;i++);}),!1);